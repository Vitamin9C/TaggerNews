{% extends "base.html" %}

{% block title %}TaggerNews - Top Stories{% endblock %}

{% block header_info %}
{% if db_oldest_date and db_newest_date %}
<p class="db-date-range">ğŸ“Š Data: {{ db_oldest_date.strftime('%b %d') }} - {{ db_newest_date.strftime('%b %d, %Y') }}
</p>
{% endif %}
{% endblock %}

{% block content %}
<div class="stories-header">
    <h2>Top Stories</h2>
    <button class="refresh-btn" hx-post="/api/v1/stories/refresh" hx-swap="none" hx-indicator=".refresh-spinner"
        onclick="this.classList.add('loading'); setTimeout(() => location.reload(), 2000);">
        <span class="refresh-spinner htmx-indicator">â³</span>
        <span>ğŸ”„ Refresh</span>
    </button>
</div>

<div class="info-bar">
    <span>{{ total }} stories{% if active_period != 'all' %} ({{ active_period }}){% endif %}{% if active_tag %} tagged
        "{{ active_tag }}"{% endif %}</span>
</div>

<div id="story-list" class="story-list">
    {% for story in stories %}
    {% include "partials/story_card.html" %}
    {% endfor %}
</div>

{% if offset + stories|length < total %} <div
    hx-get="/stories/more?offset={{ offset + limit }}&limit={{ limit }}{% if active_tag %}&tag={{ active_tag }}{% endif %}{% if active_period != 'all' %}&period={{ active_period }}{% endif %}{% if date_from %}&from={{ date_from }}{% endif %}{% if date_to %}&to={{ date_to }}{% endif %}"
    hx-trigger="revealed" hx-swap="outerHTML" class="load-more">
    <span class="loading-text">Loading more stories...</span>
    </div>
    {% endif %}
    {% endblock %}